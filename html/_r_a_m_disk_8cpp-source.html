<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>COP4610 Project 3: lab/pr3/RAMDisk.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>lab/pr3/RAMDisk.cpp</h1><a href="_r_a_m_disk_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00008 <span class="preprocessor">#include "<a class="code" href="_r_a_m_disk_8h.html">RAMDisk.h</a>"</span>
00009 
00010 RAMDisk::RAMDisk() : size(0), data(NULL)
00011 { } 
00012 
00013 RAMDisk::~RAMDisk()
00014 {
00015   <span class="keywordflow">if</span> (data)
00016     <span class="keyword">delete</span> data;
00017 }
00018 
<a name="l00019"></a><a class="code" href="class_r_a_m_disk.html#a2">00019</a> <span class="keywordtype">int</span> <a class="code" href="class_r_a_m_disk.html#a2">RAMDisk::num_blocks</a>()<span class="keyword"> const</span>
00020 <span class="keyword"></span>{
00021   <span class="keywordflow">return</span> size;
00022 }
00023 
<a name="l00024"></a><a class="code" href="class_r_a_m_disk.html#a3">00024</a> <span class="keywordtype">int</span> <a class="code" href="class_r_a_m_disk.html#a3">RAMDisk::block_size</a>()<span class="keyword"> const</span>
00025 <span class="keyword"></span>{
00026   <span class="keywordflow">return</span> <a class="code" href="_r_a_m_disk_8h.html#a0">RAM_BLOCK_SIZE</a>;
00027 }
00028 
<a name="l00029"></a><a class="code" href="class_r_a_m_disk.html#a4">00029</a> <span class="keywordtype">int</span> <a class="code" href="class_r_a_m_disk.html#a4">RAMDisk::format</a>(<span class="keywordtype">int</span> num_blocks)
00030 {
00031   <span class="keywordflow">if</span> (num_blocks &lt; 1 || num_blocks &gt; <a class="code" href="includes_8h.html#a3">MAX_NUM_BLOCKS</a>)
00032   {
00033     error1(<span class="stringliteral">"Cannot format RAM disk with %d blocks\n"</span>, num_blocks);
00034 
00035     <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00036   }
00037 
00038   <span class="keywordflow">if</span> (data)
00039     <span class="keyword">delete</span> data;
00040 
00041   size = num_blocks;
00042   data = <span class="keyword">new</span> RAMDiskBlock[size];
00043 
00044   <span class="keywordflow">if</span> (!data)
00045   {
00046     error(<span class="stringliteral">"RAM disk allocation failed\n"</span>);
00047     size = 0;
00048 
00049     <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00050   }
00051 
00052   memset(data, 0, size * <a class="code" href="_r_a_m_disk_8h.html#a0">RAM_BLOCK_SIZE</a>);
00053 
00054   <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a0">DISK_OK</a>;
00055 }
00056 
<a name="l00057"></a><a class="code" href="class_r_a_m_disk.html#a5">00057</a> <span class="keywordtype">int</span> <a class="code" href="class_r_a_m_disk.html#a5">RAMDisk::read</a>(<span class="keywordtype">int</span> block_num, <span class="keywordtype">char</span> *buf)<span class="keyword"> const</span>
00058 <span class="keyword"></span>{
00059   <span class="keywordflow">if</span> (block_num &lt; 0 || block_num &gt;= size)
00060   {
00061     error1(<span class="stringliteral">"Cannot read RAM disk block %d\n"</span>, block_num);
00062 
00063     <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00064   }
00065 
00066   memcpy(buf, data[block_num], <a class="code" href="_r_a_m_disk_8h.html#a0">RAM_BLOCK_SIZE</a>);
00067 
00068   <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a0">DISK_OK</a>;
00069 }
00070 
<a name="l00071"></a><a class="code" href="class_r_a_m_disk.html#a6">00071</a> <span class="keywordtype">int</span> <a class="code" href="class_r_a_m_disk.html#a6">RAMDisk::write</a>(<span class="keywordtype">int</span> block_num, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf)
00072 {
00073   <span class="keywordflow">if</span> (block_num &lt; 0 || block_num &gt;= size)
00074   {
00075     error1(<span class="stringliteral">"Cannot write RAM disk block %d\n"</span>, block_num);
00076 
00077     <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00078   }
00079 
00080   memcpy(data[block_num], buf, <a class="code" href="_r_a_m_disk_8h.html#a0">RAM_BLOCK_SIZE</a>);
00081 
00082   <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a0">DISK_OK</a>;
00083 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Fri Mar 24 14:26:14 2006 for COP4610 Project 3 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
