<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>COP4610 Project 3: lab/pr3/VDisk.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>lab/pr3/VDisk.cpp</h1><a href="_v_disk_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00008 <span class="preprocessor">#include "<a class="code" href="_v_disk_8h.html">VDisk.h</a>"</span>
00009 
00010 VDisk::VDisk() : size(0), fd(NULL)
00011 { } 
00012 
00013 VDisk::~VDisk()
00014 {
00015   <span class="keywordflow">if</span> (fd)
00016     fclose(fd);
00017 }
00018 
<a name="l00019"></a><a class="code" href="class_v_disk.html#a2">00019</a> <span class="keywordtype">int</span> <a class="code" href="class_v_disk.html#a2">VDisk::num_blocks</a>()<span class="keyword"> const</span>
00020 <span class="keyword"></span>{
00021   <span class="keywordflow">return</span> size;
00022 }
00023 
<a name="l00024"></a><a class="code" href="class_v_disk.html#a3">00024</a> <span class="keywordtype">int</span> <a class="code" href="class_v_disk.html#a3">VDisk::block_size</a>()<span class="keyword"> const</span>
00025 <span class="keyword"></span>{
00026   <span class="keywordflow">return</span> <a class="code" href="_v_disk_8h.html#a0">VDISK_BLOCK_SIZE</a>;
00027 }
00028 
<a name="l00029"></a><a class="code" href="class_v_disk.html#a4">00029</a> <span class="keywordtype">int</span> <a class="code" href="class_v_disk.html#a4">VDisk::format</a>(<span class="keywordtype">int</span> num_blocks)
00030 {
00031   <span class="keywordflow">if</span> (num_blocks &lt; 1 || num_blocks &gt; <a class="code" href="includes_8h.html#a3">MAX_NUM_BLOCKS</a>)
00032   {
00033     error1(<span class="stringliteral">"Cannot format VDisk with %d blocks\n"</span>, num_blocks);
00034 
00035     <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00036   }
00037 
00038   TODO(<span class="stringliteral">"Implement VDisk::format()"</span>);
00039 
00040   size = num_blocks;
00041 
00042   <span class="comment">// If fd == NULL, then open the vdisk.dat file for read/write and set fd.</span>
00043 
00044   <span class="comment">// If the vdisk.dat file does not exist, create it</span>
00045 
00046   <span class="comment">// Report error if the vdisk.dat file could not be opened</span>
00047 
00048   <span class="comment">// If the file was created, populate it with size*VDISK_BLOCK_SIZE zeros</span>
00049 
00050   <span class="comment">// If the old vdisk.dat file was opened, check if the size is too small and</span>
00051   <span class="comment">// enlarge it if necessary.</span>
00052 
00053   <span class="comment">// Hint: use libc fopen(), fseek(), and fwrite().</span>
00054 
00055   <span class="comment">// Return DISK_OK or DISK_ERROR.</span>
00056 
00057   <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00058 }
00059 
<a name="l00060"></a><a class="code" href="class_v_disk.html#a5">00060</a> <span class="keywordtype">int</span> <a class="code" href="class_v_disk.html#a5">VDisk::read</a>(<span class="keywordtype">int</span> block_num, <span class="keywordtype">char</span> *buf)<span class="keyword"> const</span>
00061 <span class="keyword"></span>{
00062   <span class="keywordflow">if</span> (block_num &lt; 0 || block_num &gt;= size)
00063   {
00064     error1(<span class="stringliteral">"Cannot read VDisk block %d\n"</span>, block_num);
00065 
00066     <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00067   }
00068 
00069   <span class="keywordflow">if</span> (!fd)
00070   {
00071     error(<span class="stringliteral">"vdisk.dat not formatted\n"</span>);
00072     
00073     <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00074   }
00075 
00076   TODO(<span class="stringliteral">"Implement VDisk::read()"</span>);
00077 
00078   <span class="comment">// Seek to the block.</span>
00079 
00080   <span class="comment">// Read the block.</span>
00081 
00082   <span class="comment">// Hint: use libc fseek(), and fread().</span>
00083 
00084   <span class="comment">// Return DISK_OK or DISK_ERROR.</span>
00085 
00086   <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00087 }
00088 
<a name="l00089"></a><a class="code" href="class_v_disk.html#a6">00089</a> <span class="keywordtype">int</span> <a class="code" href="class_v_disk.html#a6">VDisk::write</a>(<span class="keywordtype">int</span> block_num, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf)
00090 {
00091   <span class="keywordflow">if</span> (block_num &lt; 0 || block_num &gt;= size)
00092   {
00093     error1(<span class="stringliteral">"Cannot write VDisk block %d\n"</span>, block_num);
00094 
00095     <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00096   }
00097 
00098   <span class="keywordflow">if</span> (!fd)
00099   {
00100     error(<span class="stringliteral">"vdisk.dat not formatted\n"</span>);
00101 
00102     <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00103   }
00104 
00105   <span class="comment">// Seek to the block.</span>
00106 
00107   <span class="comment">// Write the block.</span>
00108 
00109   <span class="comment">// Hint: use libc fseek(), and fwrite().</span>
00110 
00111   <span class="comment">// Return DISK_OK or DISK_ERROR.</span>
00112 
00113   <span class="keywordflow">return</span> <a class="code" href="_disk_8h.html#a1">DISK_ERROR</a>;
00114 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Fri Mar 24 14:26:14 2006 for COP4610 Project 3 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
